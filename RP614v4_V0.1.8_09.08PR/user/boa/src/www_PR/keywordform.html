
<html>
<head>
	<meta http-equiv="content-type" content="text/html;charset=GB2312">
	<meta name="generator" content="Adobe GoLive 5">
	<META http-equiv='Pragma' CONTENT='no-cache'>
	<META HTTP-EQUIV="Cache-Control" CONTENT="no-cache">	
	<title>路由器表格</title> 
	<link rel="stylesheet" href="/form1.css" type="text/css">
	<script LANGUAGE="javascript"src="/utility.js"></script>
	<script language="javascript" src="/browser.js"></script>
<script language="javascript" type="text/javascript">
<!-- hide script from old browsers
ns = (document.layers) ? true : false;
ie = (document.all) ? true : false;
 
function SortD(box)  
{	
	var temp_opts = new Array();
	var temp = new Object();
	for(var i=0; i < box.options.length; i++)  
	{
		temp_opts[i] = box.options[i];
	}
	for(var x = 0; x < temp_opts.length - 1; x++) 
	{
		for(var y = (x + 1); y < temp_opts.length; y++)  
		{
			if(temp_opts[x].text > temp_opts[y].text)  
			{
				temp = temp_opts[x].text;
				temp_opts[x].text = temp_opts[y].text;
				temp_opts[y].text = temp;
			}
		}
	}
	for(var i = 0; i < box.options.length; i++)  
	{
		box.options[i].value = temp_opts[i].value;
		box.options[i].text = temp_opts[i].text;
	}
}

function doSubmit(num)
{
	if (num==1)
		document.formname.Button.value="Add Keyword";
	else if (num==2)
		document.formname.Button.value="Delete Keyword";
	else if (num==3)
		document.formname.Button.value="Clear List";
	
	if(document.formname.TrustIpEnble.checked)
		document.formname.TrustIpEnble1.value=1;
	else
		document.formname.TrustIpEnble1.value=0;

	document.formname.AddKeyword.value = document.formname.Akeyword.value;
	sumvalue1(document.formname);
	document.formname.submit();
}	

function loadcheck(){
        checkTrustIP(); 
 	var i=document.formname.KeywordEnable.value;
 	loadhelp('_keyword',' ');
 	document.formname.skeyword[i].checked=true;
   	document.formname.Akeyword.focus();
	
	if(isIE()){
		document.formname.Akeyword.size="32"
	}
	else{
		document.formname.Akeyword.size="30"
	}

	var system = OScheck();
	if(system.indexOf("Mac") >=0 ) {
		document.formname.TIP1.size="5"
		document.formname.TIP2.size="5"
		document.formname.TIP3.size="5"
		document.formname.TIP4.size="5"
	}
	else {
		document.formname.TIP1.size="4"
		document.formname.TIP2.size="4"
		document.formname.TIP3.size="4"
		document.formname.TIP4.size="4"
	}
	
	checkform(document.formname);
	//if (document.formname.TIP4.value=="0")
	//	document.formname.TIP4.value=""
}		

function loadhelp(fname,anchname) {
	if (anchname!=' ')
		top.helpframe.location.href="/help/help"+fname+".html#"+anchname
	else
		top.helpframe.location.href="/help/help"+fname+".html"
}

function checkform(A)
{
/*	var x=0;  
	if(A.TrustIP.value=="0.0.0.0")
	{ 
		x=1;
		A.TrustIP.value=A.LANIPAddr.value;
	}  
	load4(A.TrustIP,A.TIP1,A.TIP2,A.TIP3,A.TIP4);
	if(x==1)
		A.TIP4.value="0";
*/
	if((A.TrustIP.value == "")||(A.TrustIP.value=="0.0.0.0")){
		load4(A.LANIPAddr,A.TIP1,A.TIP2,A.TIP3,A.TIP4);
		A.TIP4.value="";
	}
	else{
		load4(A.TrustIP,A.TIP1,A.TIP2,A.TIP3,A.TIP4);	
	}
	A.TIP1.disabled = true;
	A.TIP2.disabled = true;
	A.TIP3.disabled = true;
}  
function sumvalue(A)
{
	var Iptest = /[0-9]{1,3}/;
    
 	document.formname.Button.value="Apply";
	if(document.formname.TrustIpEnble.checked)
		document.formname.TrustIpEnble1.value=1;
	else
		document.formname.TrustIpEnble1.value=0;
/*
 if(document.formname.TrustIpEnble.checked)
 {
	add(A.TrustIP,A.TIP1,A.TIP2,A.TIP3,A.TIP4);
 }else{
	document.formname.TIP1.value='0';
	document.formname.TIP2.value='0';
	document.formname.TIP3.value='0';
	document.formname.TIP4.value='0';
	add(A.TrustIP,A.TIP1,A.TIP2,A.TIP3,A.TIP4);	     
  }	     
*/
	add(A.TrustIP,A.TIP1,A.TIP2,A.TIP3,A.TIP4);
// if((document.formname.TIP1.value=='0')||(document.formname.TIP2.value=='0')||(document.formname.TIP3.value=='0')||(document.formname.TIP4.value=='0'))
//	     document.formname.TrustIpEnble.checked=false;

	if(A.TrustIpEnble.checked){
		if((A.TIP1.value<0) || (A.TIP1.value>255) || (Iptest.test(A.TIP1.value)!=true)||
		(A.TIP2.value<0) || (A.TIP2.value>255) || (Iptest.test(A.TIP2.value)!=true)||
		(A.TIP3.value<0) || (A.TIP3.value>255) || (Iptest.test(A.TIP3.value)!=true)||
		(A.TIP4.value<=0) || (A.TIP4.value>255) || (Iptest.test(A.TIP4.value)!=true))
		{
			alert("可信IP地址无效。");
			return false;
		} 
		var ipaddr0 = IPv4toString(getValue(document.formname.TIP1.value),getValue(document.formname.TIP2.value),getValue(document.formname.TIP3.value),getValue(document.formname.TIP4.value));
		if(!isValidIP(ipaddr0))
		{
		    alert("可信IP地址无效。");
		    return false;
		}
	
/*		if(addressBlur(A.TrustIP))	     
			return true;
		else
			return false;  
*/	}
	return true;         
} 
function sumvalue1(A)
{
	add(A.TrustIP,A.TIP1,A.TIP2,A.TIP3,A.TIP4);
	/*
	if((document.formname.TIP1.value=='0')||(document.formname.TIP2.value=='0')||(document.formname.TIP3.value=='0')||(document.formname.TIP4.value=='0'))
	     document.formname.TrustIpEnble.checked=false;
	*/
	return true;
}

function changepage(){
	window.location.replace("keywordform.html");
}
//add by jenny 051228
function checkTrustIP()
{
	if(document.formname.TrustIpEnble.checked)
	{
		//document.formname.TIP1.disabled = false;
		//document.formname.TIP2.disabled = false;
		//document.formname.TIP3.disabled = false;
		document.formname.TIP4.disabled = false;
		
	}
	else
	{
		//document.formname.TIP1.disabled = true;
		//document.formname.TIP2.disabled = true;
		//document.formname.TIP3.disabled = true;
		document.formname.TIP4.disabled = true;
	}
}
//end  
function check(x){
	document.formname.KeywordEnable.value=x; 
}
function presskey(){
	if(event.keyCode==13)
	doSubmit(1);
}
//-->
</script> 
</head>
<body bgcolor="#ffffff" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0" onload="loadcheck()">
<form name="formname" action="/cgi-bin/apply.cgi" method="POST" onKeydown="presskey()">
<input type="hidden" name="page" value="keywordform.html">
<input type=hidden name="action" value="Apply">
<input type="hidden" name="Load" value="K">
<input type=hidden name="read" value="$$L#ReadLAN$$">
	<table border="0" cellpadding="0" cellspacing="3" width="100%">
		<tr>
			<td colspan="2">
				<h1>站点限制</h1>
			</td>
		</tr>
<!-- RULE //-->
		<tr>
			<td colspan="2">
    			<img src="/img/liteblue.gif" width="100%" height="2" border="0">
    		</td>
    	</tr>
<!-- END RULE //-->
		<tr>
			<td colspan="2">
				    <a href="javascript:loadhelp('_keyword','blocking')"><b>关键字限制</b></a><br>
				           <input type=radio value="0" name="skeyword" onClick="check(this.value)">从不<br> 
				           <input type=radio value="1" name="skeyword" onClick="check(this.value)">按时间安排<br>
				           <input type=radio value="2" name="skeyword" onClick="check(this.value)">始终
				        
					<b><input type=hidden value=<% nvram_get("fw_keywordenable"); %> name="KeywordEnable" >
					<input type="hidden" name="TrustIpEnble1" >
				
			</td>
		</tr>
		
		<!-- RULE //-->
		<tr>
			<td colspan="2">
				<img src="/img/liteblue.gif" width="100%" height="2" border="0"> 
			</td>
		</tr>
		<!-- END RULE //-->
		<tr>
			<td nowrap colspan="2">
			    <b><a href="javascript:loadhelp('_keyword','toaddword')"> 请在这里输入关键字或域名：</a></b><br>
				<input type="hidden" name="AddKeyword">
			    <input type="hidden" name="TrustIP" value="<% nvram_get("fw_trustip"); %>"  size="15">
			   <input type="hidden" name="LANIPAddr" value="<% nvram_get("lan_ipaddr"); %>">
				<input type="text" name="Akeyword" size="32" maxlength="49"> 
			</td>
		</tr>
		<tr>
			<td width="50%" align="left">
				<input type=hidden name="Button" value="0">
				<input name="ButtonApp" onclick="doSubmit(1);" value="添加关键字"  type="Button" >

			</td>
		</tr>
		
			<!-- RULE //-->
		<tr>
			<td colspan="2">
				<img src="/img/liteblue.gif" width="100%" height="2" border="0"> 
			</td>
		</tr>
	
		<!-- END RULE //-->
		<tr>
			<td nowrap colspan="2"><a href="javascript:loadhelp('_keyword','blocklist')">
				<b>对包含以下关键字或域名的网站进行限制：</b>
			</a></td>
		</tr>
		<tr>
			<td colspan="2">
				<select name="DomainList" class=ttext onchange="this.form.Akeyword.value = this.options[this.selectedIndex].text;" size="6" multiple><% nvram_fw_domain_list(); %></select> 
			</td>
		</tr>
		</table>
		<table border="0" cellpadding="0" cellspacing="3" width="100%">
		<tr>
			<td nowrap align="left">
 				<input name="ButtonApp" onclick="doSubmit(2);" type="Button" value="删除关键字" > 

				<input type="Button" name="ButtonApp" value="清除列表" onclick="doSubmit(3);">
			</td>
		</tr>
		</table>
		<table border="0" cellpadding="0" cellspacing="3" width="100%">
		<!-- RULE //-->
		<tr>
			<td colspan="2">
				<img src="/img/liteblue.gif" width="100%" height="2" border="0"> 
			</td>
		</tr>
		<!-- END RULE //-->
		<tr>
<td nowrap colspan="2">
	
		<input type="checkbox" value="1" name="TrustIpEnble"  onclick= "checkTrustIP();" tabindex="1" <% checkbox_checked("fw_trustipenable"); %>> <a href="javascript:loadhelp('_keyword','trusted')"> <b>允许可信IP地址访问被限制的网站</b> 
	
	</a> 		
	
		<tr>
				<td nowrap width="40%" align="left"><b><a href="javascript:loadhelp('_keyword','trusted')">可信IP地址</a></b></td>
				<td width="60%" align="right">
				<img src="/img/spacer.gif" width="50%" height="1" border=0><br>
				<input type="text" class="num" name="TIP1" value=""  size="4" maxlength="3" onfocus="if (!this.form.TrustIpEnble.checked) this.form.TrustIpEnble.focus();" onkeypress="chk_num(event)"><b>.</b>
				<input type="text" class="num" name="TIP2" value=""  size="4" maxlength="3" onfocus="if (!this.form.TrustIpEnble.checked) this.form.TrustIpEnble.focus();" onkeypress="chk_num(event)"><b>.</b>
				<input type="text" class="num" name="TIP3" value=""  size="4" maxlength="3" onfocus="if (!this.form.TrustIpEnble.checked) this.form.TrustIpEnble.focus();" onkeypress="chk_num(event)"><b>.</b>
				<input type="text" class="num" name="TIP4" value=""  size="4" maxlength="3" onfocus="if (!this.form.TrustIpEnble.checked) this.form.TrustIpEnble.focus();" onkeypress="chk_num(event)">
				</td>
			</tr>
		<tr>
			<td colspan="2">
				<img src="/img/liteblue.gif" width="100%" height="2" border="0"> 
			</td>
		</tr>
		<tr>
			<td align="center" colspan="2">
				<input type="Button" name="ButtonApp" value="应用" OnClick="if (sumvalue(this.form)) document.formname.submit()"> <!--<input type="button" name="Cancel" value="Cancel" onclick="location.reload();">//--><input type="button" name="Cancel" value="取消" onclick="changepage();"
			</td>
		</tr>
	</table>
</form>
<p>
</p>
<SCRIPT language=JavaScript>
<!--
	SortD(document.forms[0].DomainList);
// //-->
</SCRIPT>
</body>
</html>
