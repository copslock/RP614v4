<html>
<head>
	<meta http-equiv="content-type" content="text/html;charset=GB2312">
	<meta name="generator" content="Adobe GoLive 5">
	<META http-equiv='Pragma' CONTENT='no-cache'>
	<META HTTP-EQUIV="Cache-Control" CONTENT="no-cache">

<title>远程管理</title>
	<link rel="stylesheet" href="/form1.css" type="text/css">
	<script language="javascript" src="/browser.js"></script>
	<script language="javascript" type="text/javascript" src="/utility.js"></script>
<script language="javascript" type="text/javascript">
<!-- hide script from old browsers
function loadhelp(fname,anchname)
{
	if (anchname!=' ')
		top.helpframe.location.href="/help/help"+fname+".html#"+anchname;
	else
		top.helpframe.location.href="/help/help"+fname+".html";
}

function checkip(F)
{
	var Iptest = /[0-9]{1,3}/;
	if(F.iptype[0].checked==true)
		F.iptypehidden.value=2;
	else if(F.iptype[1].checked==true)
		F.iptypehidden.value=1;
	else if(F.iptype[2].checked==true)
		F.iptypehidden.value=0;

	if(F.iptype[1].checked==true)
	{
		if (checkIP(F.StartIP1, F.StartIP2, F.StartIP3, F.StartIP4, 254)||(parseInt(F.StartIP1.value) == 127))		{
			alert("IP地址无效。");
			return false;
		}
		if (checkIP(F.EndIP1, F.EndIP2, F.EndIP3, F.EndIP4, 254)||(parseInt(F.EndIP1.value) == 127))		{
			alert("IP地址无效。");
			return false;
		}
		if((F.StartIP1.value<=0) || (F.StartIP1.value>255) || (Iptest.test(F.StartIP1.value)!=true)||
		 	(F.StartIP2.value<0) || (F.StartIP2.value>255) || (Iptest.test(F.StartIP2.value)!=true)||
		 	(F.StartIP3.value<0) || (F.StartIP3.value>255) || (Iptest.test(F.StartIP3.value)!=true)||
		 	(F.StartIP4.value<=0) || (F.StartIP4.value>255) || (Iptest.test(F.StartIP4.value)!=true))
		{
			alert("起始IP地址无效。");
			return false;
		}
		else if((F.EndIP1.value<=0) || (F.EndIP1.value>255) || (Iptest.test(F.EndIP1.value)!=true)||
		 	(F.EndIP2.value<0) || (F.EndIP2.value>255) || (Iptest.test(F.EndIP2.value)!=true)||
		 	(F.EndIP3.value<0) || (F.EndIP3.value>255) || (Iptest.test(F.EndIP3.value)!=true)||
		 	(F.EndIP4.value<=0) || (F.EndIP4.value>255) || (Iptest.test(F.EndIP4.value)!=true))
		{
			alert("结束IP地址无效。");
			return false;
		}

		var	startip=iplength(F.StartIP1)+iplength(F.StartIP2)+iplength(F.StartIP3)+iplength(F.StartIP4);
	 	var	endip  =iplength(F.EndIP1)+iplength(F.EndIP2)+iplength(F.EndIP3)+iplength(F.EndIP4);

		if(startip-endip>0)
		{
			alert("起始IP必须小于结束IP。");
			return false;
		}
	}

	if(F.iptype[0].checked==true)
	{
		if (checkIP(F.PCIP1, F.PCIP2, F.PCIP3, F.PCIP4, 254))		{
			alert("IP地址无效。");
			return false;
		}
		if((F.PCIP1.value<=0) || (F.PCIP1.value>255) || (Iptest.test(F.PCIP1.value)!=true)||
		   (F.PCIP2.value<0) || (F.PCIP2.value>255) || (Iptest.test(F.PCIP2.value)!=true)||
		   (F.PCIP3.value<0) || (F.PCIP3.value>255) || (Iptest.test(F.PCIP3.value)!=true)||
		   (F.PCIP4.value<=0) || (F.PCIP4.value>255) || (Iptest.test(F.PCIP4.value)!=true))
		{
			alert("IP地址无效。");
			return false;
		}
	}
	if(ValidPort(F))		return false;		
	return true;
}

function iptypecheck()
{
    document.formname.space.width=230;

	var system = OScheck();
	if(system.indexOf("Mac")>=0)
	{
		document.formname.PCIP1.size="5";
		document.formname.PCIP2.size="5";
		document.formname.PCIP3.size="5";
		document.formname.PCIP4.size="5";
		document.formname.StartIP1.size="5";
		document.formname.StartIP2.size="5";
		document.formname.StartIP3.size="5";
		document.formname.StartIP4.size="5";
		document.formname.EndIP1.size="5";
		document.formname.EndIP2.size="5";
		document.formname.EndIP3.size="5";
		document.formname.EndIP4.size="5";
		document.formname.RemoteIpPort.size="9";
	}
	else
	{
		document.formname.PCIP1.size="4";
		document.formname.PCIP2.size="4";
		document.formname.PCIP3.size="4";
		document.formname.PCIP4.size="4";
		document.formname.StartIP1.size="4";
		document.formname.StartIP2.size="4";
		document.formname.StartIP3.size="4";
		document.formname.StartIP4.size="4";
		document.formname.EndIP1.size="4";
		document.formname.EndIP2.size="4";
		document.formname.EndIP3.size="4";
		document.formname.EndIP4.size="4";
		document.formname.RemoteIpPort.size="6";
	}

	if ((document.formname.StartIP1.value==0)&&(document.formname.StartIP2.value==0)&&(document.formname.StartIP3.value==0)&&(document.formname.StartIP4.value==0)
		&&(document.formname.EndIP1.value==255)&&(document.formname.EndIP2.value==255)&&(document.formname.EndIP3.value==255)&&(document.formname.EndIP4.value==255))	
	{	
		document.formname.StartIP1.value="";		
		document.formname.StartIP2.value="";	
		document.formname.StartIP3.value="";	
		document.formname.StartIP4.value="";	
		document.formname.EndIP1.value="";	
		document.formname.EndIP2.value="";	
		document.formname.EndIP3.value="";	
		document.formname.EndIP4.value="";	
		document.formname.PCIP1.value="";	
		document.formname.PCIP2.value="";	
		document.formname.PCIP3.value="";	
		document.formname.PCIP4.value="";	
		document.formname.iptype[2].checked=true;
	}
	else if((document.formname.StartIP1.value==document.formname.EndIP1.value)&&(document.formname.StartIP2.value==document.formname.EndIP2.value)
		  &&(document.formname.StartIP3.value==document.formname.EndIP3.value)&&(document.formname.StartIP4.value==document.formname.EndIP4.value))	
	{
		document.formname.StartIP1.value="";		
		document.formname.StartIP2.value="";	
		document.formname.StartIP3.value="";	
		document.formname.StartIP4.value="";	
		document.formname.EndIP1.value="";	
		document.formname.EndIP2.value="";	
		document.formname.EndIP3.value="";	
		document.formname.EndIP4.value="";
		document.formname.iptype[0].checked=true;
	}
	else
	{
		document.formname.PCIP1.value="";	
		document.formname.PCIP2.value="";	
		document.formname.PCIP3.value="";	
		document.formname.PCIP4.value="";	
		document.formname.iptype[1].checked=true;
	}

	loadhelp('_remoteip',' ');
	
}

function disableItem(init)
{
	if (init==0)
	{			
		if(document.formname.iptype[2].checked==true)
		{
			document.formname.StartIP1.value="";		
			document.formname.StartIP2.value="";	
			document.formname.StartIP3.value="";	
			document.formname.StartIP4.value="";	
			document.formname.EndIP1.value="";	
			document.formname.EndIP2.value="";	
			document.formname.EndIP3.value="";	
			document.formname.EndIP4.value="";	
			document.formname.PCIP1.value="";	
			document.formname.PCIP2.value="";	
			document.formname.PCIP3.value="";	
			document.formname.PCIP4.value="";	
		}
	}
	else if(init==1)
	{
		if(document.formname.iptype[1].checked==true)
		{
			document.formname.PCIP1.value="";	
			document.formname.PCIP2.value="";	
			document.formname.PCIP3.value="";	
			document.formname.PCIP4.value="";		
		}
	}
	else if(init==2)
	{
		if(document.formname.iptype[0].checked==true)
		{
			document.formname.StartIP1.value="";		
			document.formname.StartIP2.value="";	
			document.formname.StartIP3.value="";	
			document.formname.StartIP4.value="";	
			document.formname.EndIP1.value="";	
			document.formname.EndIP2.value="";	
			document.formname.EndIP3.value="";	
			document.formname.EndIP4.value="";		
		}
	}
}

function iplength(iplen)
 {
 	var iplen2;
 	if(iplen.value.length==2)
 	iplen2="0" + iplen.value.toString();
 	else if(iplen.value.length==1)
 	iplen2="00" + iplen.value.toString();
 	else
 	iplen2=iplen.value.toString();
 	
	return iplen2;
 }
function cancel()
{
	location="/remoteip.html";
}

function ValidPort(F)
{
	P0 = parseInt(F.RemoteIpPort.value, 10);
	if(!( P0 >= 1024 && P0 <= 65534))
	{
		alert("端口号无效");
		//F.value = F.defaultValue;			return true;	
	}
}

//-->
</script> 
</head>
<body bgcolor="#ffffff" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0" onload="iptypecheck();">
<form name="formname" method="POST" action="/cgi-bin/apply.cgi">
<input type="hidden" name="page" value="remoteip.html">
<input type=hidden name="action" value="Apply">
<input type="hidden" name="Load" value="R">
<table border="0" cellpadding="0" cellspacing="3" width="100%">
	<tr>
		<td colspan="2">
			<h1>远程管理</h1>
		</td>
	</tr>
<!-- RULE //-->
	<tr>
		<td colspan="2">
			<img src="/img/liteblue.gif" width="100%" height="2" border="0"> 
		</td>
	</tr>
<!-- END RULE //-->
    <tr>
		<td colspan="2">
			<input type=checkbox name="remoteen" value=1 <% checked_match("fw_remoteenable", "1"); %>><a href="javascript:loadhelp('_remoteip','turnon')"><b>打开远程管理</b></a> 
			<input type="hidden" name="iptypehidden" value="">
		</td>
	</tr>
	<tr>
		<td colspan="2">
			<img src="/img/liteblue.gif" width="100%" height="2" border="0"> 
		</td>
	</tr>
 	<tr>
		<td>
			<a href="javascript:loadhelp('_remoteip','address')"><b>远程管理地址：</b></a> 
			<br> <% nvram_get("wan0_ipaddr"); %>:<% nvram_get("http_wanport"); %>
		</td>
	</tr>
	<tr>
		<td colspan="2">
			<img src="/img/liteblue.gif" width="100%" height="2" border="0"> 
		</td>
	</tr>
	<tr>
		<td colspan="2">
			<a href="javascript:loadhelp('_remoteip','access')"><b>允许从下列地址进行远程访问：</b></a>
		</td>
	</tr>
	<tr>
		<td colspan="2">
		<table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td width="45%" align="left" valign="top" nowrap>
					<input type=radio name="iptype" value="" onclick="disableItem(2)">
					仅本计算机：
				</td>
				<td width="55%" align="right" nowrap>
					<img src="/img/spacer.gif" width="10" height="12" border="0">		
					<input type="text" class="num" name="PCIP1" size="2" maxlength="3" value="<% field_nvram_get("remote_config_ip", ".", "1"); %>"
					onfocus="if (this.form.iptype[2].checked) this.form.iptype[0].focus();if (this.form.iptype[1].checked) this.form.iptype[1].focus();"					onkeypress="chk_num(event)">
					<b>.</b> 
					<input type="text" class="num" name="PCIP2" size="2" maxlength="3" value="<% field_nvram_get("remote_config_ip", ".", "2"); %>"
					onfocus="if (this.form.iptype[2].checked) this.form.iptype[0].focus();if (this.form.iptype[1].checked) this.form.iptype[1].focus();"					onkeypress="chk_num(event)">
					<b>.</b> 
					<input type="text" class="num" name="PCIP3" size="2" maxlength="3" value="<% field_nvram_get("remote_config_ip", ".", "3"); %>"
					onfocus="if (this.form.iptype[2].checked) this.form.iptype[0].focus();if (this.form.iptype[1].checked) this.form.iptype[1].focus();"					onkeypress="chk_num(event)">
					<b>.</b>
					<input type="text" class="num" name="PCIP4" size="2" maxlength="3" value="<% field_nvram_get("remote_config_ip", ".", "4"); %>"
					onfocus="if (this.form.iptype[2].checked) this.form.iptype[0].focus();if (this.form.iptype[1].checked) this.form.iptype[1].focus();"					onkeypress="chk_num(event)">
					<br>
				</td>
			</tr>
			<tr>
				<td width="45%" align="left" nowrap>
				<!--	<img src="/img/spacer.gif" width="159" height="1" border=0>  Amy 2005,12,06-->
					<input type="radio" name="iptype" value="" onclick="disableItem(1)">
					IP地址范围：
				</td>
				
				<td width="55%" align="right" nowrap>
					<img src="/img/spacer.gif" width="250" height="1" border=0 name="space">
					<br><img src="/img/spacer.gif" width="10" height="12" border="0">
					起始IP地址
					<input type="text" class="num" name="StartIP1" size="4" maxlength="3" value="<% field_nvram_get("remote_config_ip_start", ".", "1"); %>"
					onfocus="if (this.form.iptype[0].checked) this.form.iptype[0].focus();if (this.form.iptype[2].checked) this.form.iptype[2].focus();"					onkeypress="chk_num(event)">
					<b>.</b> 
					<input type="text" class="num" name="StartIP2" size="4" maxlength="3" value="<% field_nvram_get("remote_config_ip_start", ".", "2"); %>"
					onfocus="if (this.form.iptype[0].checked) this.form.iptype[0].focus();if (this.form.iptype[2].checked) this.form.iptype[2].focus();"					onkeypress="chk_num(event)">
					<b>.</b> 
					<input type="text" class="num" name="StartIP3" size="4" maxlength="3" value="<% field_nvram_get("remote_config_ip_start", ".", "3"); %>"
					onfocus="if (this.form.iptype[0].checked) this.form.iptype[0].focus();if (this.form.iptype[2].checked) this.form.iptype[2].focus();"					onkeypress="chk_num(event)">
					<b>.</b>
					<input type="text" class="num" name="StartIP4" size="4" maxlength="3" value="<% field_nvram_get("remote_config_ip_start", ".", "4"); %>"
					onfocus="if (this.form.iptype[0].checked) this.form.iptype[0].focus();if (this.form.iptype[2].checked) this.form.iptype[2].focus();"					onkeypress="chk_num(event)">
				</td>
			</tr>
			<tr>
				<td width="45%" align="left" nowrap>
				</td>
				<td width="55%" align="right" nowrap>
					结束IP地址
					<input type="text" class="num" name="EndIP1" size="4" maxlength="3" value="<% field_nvram_get("remote_config_ip_end", ".", "1"); %>"
					onfocus="if (this.form.iptype[0].checked) this.form.iptype[0].focus();if (this.form.iptype[2].checked) this.form.iptype[2].focus();"					onkeypress="chk_num(event)">
					<b>.</b> 
					<input type="text" class="num" name="EndIP2" size="4" maxlength="3" value="<% field_nvram_get("remote_config_ip_end", ".", "2"); %>"
					onfocus="if (this.form.iptype[0].checked) this.form.iptype[0].focus();if (this.form.iptype[2].checked) this.form.iptype[2].focus();"					onkeypress="chk_num(event)">
					<b>.</b> 
					<input type="text" class="num" name="EndIP3" size="4" maxlength="3" value="<% field_nvram_get("remote_config_ip_end", ".", "3"); %>"
					onfocus="if (this.form.iptype[0].checked) this.form.iptype[0].focus();if (this.form.iptype[2].checked) this.form.iptype[2].focus();"					onkeypress="chk_num(event)">
					<b>.</b>
					<input type="text" class="num" name="EndIP4" size="4" maxlength="3" value="<% field_nvram_get("remote_config_ip_end", ".", "4"); %>"
					onfocus="if (this.form.iptype[0].checked) this.form.iptype[0].focus();if (this.form.iptype[2].checked) this.form.iptype[2].focus();"					onkeypress="chk_num(event)">
					<br>
				</td>
			</tr>
		</table>
		<table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td colspan="2">
					<input type="radio" name="iptype" value=""  onclick="disableItem(0)">
					所有人
				</td>
			</tr>
		</table>
		<table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td colspan="2">
					<img src="/img/liteblue.gif" width="100%" height="2" border="0"> 
				</td>
			</tr>
			<tr>
				<td width="45%" align="left" nowrap>
					<a href="javascript:loadhelp('_remoteip','port')"><b>端口号：</b></a>
				</td>
				<td width="55%" align="right">
					<img src="/img/spacer.gif" width="100" height="12" border="0">
					<input type="text" class="num" name="RemoteIpPort" size="6" maxlength="5" value="<% nvram_get("http_wanport"); %>" onkeypress="chk_num(event)">
				</td>
			</tr>
		</table>
		</td>
	</tr>
	
<!-- RULE //-->
	<tr>
		<td colspan="2">
			<img src="/img/liteblue.gif" width="100%" height="2" border="0"> 
		</td>
	</tr>
<!-- END RULE //-->

	<tr>
		<td colspan="2" align="center">
	<!-- <center> -->		
			<input type="hidden" name="WritepageR" value="">
			<input type=hidden name="Button" value="Apply">
			<input type="Button" value="应用" onclick="if (checkip(this.form)) document.formname.submit();">
			<input type="button" name="Cancel" value="取消" onclick="cancel();">
	<!-- </center>-->
</table>
</form>
<p>
</p>
</body>

</html>
